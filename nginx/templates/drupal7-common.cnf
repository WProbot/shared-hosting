location / {
  try_files $uri /index.php?$query_string;
}

location @rewrite {
  rewrite ^/(.*)$ /index.php?q=$1;
}

location ~* \.(txt|log)$ {
  return 404;
}

location ~ ^/sites/.*/private/ {
  return 404;
}

location ~ ^/sites/.*/files/styles/ {
  try_files $uri @rewrite;
}

location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
  try_files $uri @rewrite;
}

location ~ \.php(/|$) {
  include snippets/fastcgi-php.conf;
  fastcgi_split_path_info ^(.+?\.php)(|/.*)$;
  fastcgi_param HTTP_PROXY "";
  fastcgi_pass unix:/run/php/php7.1-$SITEUSER.sock;
}
